<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gcdyn.cycles &mdash; gcdyn  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> gcdyn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cite.html">Citing <code class="docutils literal notranslate"><span class="pre">gcdyn</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer.html">Open source code repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer.html#developer-tools">Developer tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer.html#todo-list">Todo list</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gcdyn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>gcdyn.cycles</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gcdyn.cycles</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Germinal center light zone / dark-zone cycles simulator.</span>

<span class="sd">Borrowing from `gctree &lt;https://github.com/matsengrp/gctree/blob/master/gctree/mutation_model.py&gt;`_</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">ete3</span> <span class="kn">import</span> <span class="n">TreeNode</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>


<div class="viewcode-block" id="ExtinctionError"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.ExtinctionError.html#gcdyn.cycles.ExtinctionError">[docs]</a><span class="k">class</span> <span class="nc">ExtinctionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The simulation has resulted in extintion of all lineages.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="GC"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.GC.html#gcdyn.cycles.GC">[docs]</a><span class="k">class</span> <span class="nc">GC</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A class for simulating a germinal center with discrete LZ :math:`\leftrightarrow` DZ cycles.</span>

<span class="sd">    Args:</span>
<span class="sd">        sequence: root nucleotide sequence</span>
<span class="sd">        proliferator: neutral tree generator for DZ proliferation and mutation. This tree is assumed to run for exactly one unit of simulation time, but this is not enforced (if not, you may generate non-ultrametric trees). If it produces extinct leaves, they should be marked with a node attribute ``node.terminated = True``.</span>
<span class="sd">        mutator: mutation generator that takes a starting sequence and an exposure time and returns a mutated sequence</span>
<span class="sd">        selector: takes a list of sequences and returns their fitness parameters</span>
<span class="sd">        N0: initial naive abundance</span>
<span class="sd">        Nmax: population capacity. If not ``None`` and the number of alive cells exceeds ``Nmax`` in any cycle, the population will be randomly downsampled to size ``Nmax``.</span>
<span class="sd">        rng: random number generator</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GC.__init__"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.html#gcdyn.cycles.GC.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">proliferator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">TreeNode</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">mutator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">selector</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
        <span class="n">N0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">Nmax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(),</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">TreeNode</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">terminated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proliferator</span> <span class="o">=</span> <span class="n">proliferator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutator</span> <span class="o">=</span> <span class="n">mutator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="n">selector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nmax</span> <span class="o">=</span> <span class="n">Nmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">rng</span>

        <span class="k">if</span> <span class="n">N0</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N0</span><span class="p">):</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">TreeNode</span><span class="p">()</span>
                <span class="n">child</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span>
                <span class="n">child</span><span class="o">.</span><span class="n">terminated</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alive_leaves</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">leaf</span> <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">])</span></div>

<div class="viewcode-block" id="GC.step"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.GC.html#gcdyn.cycles.GC.step">[docs]</a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enforce_timescale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Simulate one cycle.</span>

<span class="sd">        Args:</span>
<span class="sd">            enforce_timescale: if ``True``, the time scale of the DZ proliferation tree must be consistent with the global timescale (one unit per step)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fitnesses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">([</span><span class="n">leaf</span><span class="o">.</span><span class="n">sequence</span> <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_leaves</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">leaf</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_leaves</span><span class="p">,</span> <span class="n">fitnesses</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proliferator</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">leaf</span><span class="o">.</span><span class="n">iter_descendants</span><span class="p">():</span>
                <span class="n">node</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutator</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">up</span><span class="o">.</span><span class="n">sequence</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">dist</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">enforce_timescale</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subleaf</span> <span class="ow">in</span> <span class="n">leaf</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">subleaf</span><span class="o">.</span><span class="n">terminated</span> <span class="ow">and</span> <span class="n">leaf</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="n">subleaf</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;DZ subtree timescale is not consistent with simulation time&quot;</span>
                        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_leaves</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">leaf</span> <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">leaf</span><span class="o">.</span><span class="n">terminated</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nmax</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_leaves</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_leaves</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nmax</span><span class="p">),</span>
                <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">leaf</span><span class="o">.</span><span class="n">terminated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alive_leaves</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span></div>

<div class="viewcode-block" id="GC.prune"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.GC.html#gcdyn.cycles.GC.prune">[docs]</a>    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Prune the tree to the subtree induced by the alive leaves.&quot;&quot;&quot;</span>
        <span class="n">event_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_cached_content</span><span class="p">(</span><span class="n">store_attr</span><span class="o">=</span><span class="s2">&quot;terminated&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">is_leaf_fn</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">event_cache</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">is_leaf_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExtinctionError</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">is_leaf_fn</span><span class="o">=</span><span class="n">is_leaf_fn</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_leaf_fn</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span></div>

<div class="viewcode-block" id="GC.simulate"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.GC.html#gcdyn.cycles.GC.simulate">[docs]</a>    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">T</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">max_tries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">enforce_timescale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Simulate.</span>

<span class="sd">        Args:</span>
<span class="sd">            T: number of cycles to simulate</span>
<span class="sd">            prune: prune to the tree induced by the surviving lineages</span>
<span class="sd">            max_tries: try this many times to simulate a tree that doesn&#39;t go extinct</span>
<span class="sd">            enforce_timescale: if ``True``, the time scale of the DZ proliferation trees must be consistent with the global timescale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">n_tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">enforce_timescale</span><span class="o">=</span><span class="n">enforce_timescale</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prune</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">ExtinctionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">n_tries</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">n_tries</span> <span class="o">==</span> <span class="n">max_tries</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">err</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">remove_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">terminated</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="binary_proliferator"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.binary_proliferator.html#gcdyn.cycles.binary_proliferator">[docs]</a><span class="k">def</span> <span class="nf">binary_proliferator</span><span class="p">(</span>
    <span class="n">treenode</span><span class="p">:</span> <span class="n">TreeNode</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Binary dark zone step (Galton-Watson).</span>
<span class="sd">    With probability :math:`1-p` the input&#39;s ``terminated`` attribute is set to ``True``, indicating extinction.</span>
<span class="sd">    With probability :math:`p` add two children to the the input with ``terminated`` attributes set to ``False``, indicating birth.</span>

<span class="sd">    Args:</span>
<span class="sd">        treenode: root node to simulate from</span>
<span class="sd">        p: bifurcation probability :math:`p \in [0, 1]`</span>
<span class="sd">        rng: random number generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">treenode</span><span class="o">.</span><span class="n">terminated</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">TreeNode</span><span class="p">()</span>
            <span class="n">child</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">child</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">treenode</span><span class="o">.</span><span class="n">sequence</span>
            <span class="n">child</span><span class="o">.</span><span class="n">terminated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">treenode</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span></div>


<div class="viewcode-block" id="uniform_mutator"><a class="viewcode-back" href="../../stubs/gcdyn.cycles.uniform_mutator.html#gcdyn.cycles.uniform_mutator">[docs]</a><span class="k">def</span> <span class="nf">uniform_mutator</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Uniform mutation process at rate 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        sequence: initial sequence, consisting of characters ``ACGT``</span>
<span class="sd">        time: exposure time</span>
<span class="sd">        rng: random number generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alphabet</span> <span class="o">=</span> <span class="s2">&quot;ACGT&quot;</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">rng</span><span class="o">.</span><span class="n">exponential</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span>
            <span class="n">sequence</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                <span class="p">[</span><span class="n">base</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">alphabet</span> <span class="k">if</span> <span class="n">base</span> <span class="o">!=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Erick Matsen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>